---
title: 图解 HTTP 学习笔记
tags:
---


## 1. 单台虚拟主机实现多个域名


HTTP/1.1 允许使用一台 HTTP 服务器搭建多个 Web 站点。这是因为使用了虚拟主机的功能，在物理层面只有一台服务器，但是只要使用虚拟主机的功能，则可以假想具有多台服务器。


客户端发起的 HTTP 请求时，使用的主机名和域名(wwww.baidu.com),在通过 DNS 解析，请求发送到服务器是，已经是以 IP 的形式访问了。


![](/source/images/2019_12_12_01.png)

如果一台服务器托管了两个域名，在经过 DNS 解析后，会映射到相同的 IP 上，那么服务器在接收到网络请求时，就需要分辨访问的是哪一个域名，所以在发起网络请求时，需要在 Host 中完整的指定主机名和域名。


## 2. 通信数据转发程序：代理、网关、隧道


在发起 HTTP 网络请求时，除了涉及客户端和服务端，还会涉及用于通信数据转发的 **应用程序**，比如代理、网关、隧道，配合服务器工作。


这些应用程序和服务器可以 **将请求转发给通信链路上的下一站服务器**，并且可以将服务器的响应转发给服务器。


### 2.1 代理


代理是具有转发功能的应用程序。

![](/source/images/2019_12_12_02.png)

代理服务器不会改变请求的 URI，会直接转发给通信线路中持有资源的下一站服务器。

每次通过代理服务器转发的请求或者响应时，都会在 Via 首部信息中写入代理服务器的信息。


**使用代理服务器的原因**：

* 利用缓存技术减少网络带宽的流量
* 组织内部针对特定网站的访问控制，以获取访问的日志


### 代理的方式

以两种基准分类：
1. 是否使用缓存
2. 是否修改报文

**缓存代理**

1. 代理转发响应时，缓存代理会先将资源的副本保存在代理服务器上。
2. 当代理再次收到对相同资源的请求时，不直接从源服务器获取资源，而是将缓存在代理服务器上的资源作为响应返回。

很明显，通过代理服务器可以减轻客户端与源服务器的之间的请求次数。


**透明代理**

转发请求或响应时，不对报文做任何更改的代理类型称为 透明代理，反之为 非透明代理。

### 2.2 网关

网关与代理的工作机制很像，都是作为客户端与源服务器的中间环节，作用请求或响应过程，不同的是网关可以使通信线路上的服务其提供 **非 HTTP 协议服务**。

![](/source/images/2019_12_12_03.png)


利用网关可以提高网络通信的安全性，可以在客户端和网关之间的通信线路上加密，从而确保连接的安全。

使用案例：

* 网关可以连接数据库，使用 SQL 语言查询数据
* 信用卡支付时，可以使用网关和信用卡结算系统联动。


### 2.3 隧道

![](/source/images/2019_12_12_04.png)


隧道的目的是 **确保客户端能与服务器进行安全的通信**。

隧道可以按照要求建立起一条与其他服务器的通信线路，使用 SSL 等加密手段进行通信。

隧道是透明的，本身不会解析 HTTP 请求，会将原本的请求转发给之后的服务器，而且隧道也会在通信双方断开连接是结束，同时由于隧道是透明的，所以客户端不用在意隧道的存在。

## 保存资源的缓存


**缓存是指代理服务器或者客户端本地磁盘中保存着资源的副本**，利用缓存可以减少客户端对源服务器的访问，节省了通信流量和通信时间。







